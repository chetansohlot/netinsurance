{% extends 'master.html' %}

{% block title %}
    Members
{% endblock %}
  
{% block content %}
{% load static %}

<!-- Bootstrap CSS -->
<!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"> -->

<!-- Bootstrap Bundle with Popper.js -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> -->

<body class="hold-transition sidebar-mini">
    <div class="wrapper">
        {% include 'navbar.html' %}

        {% include 'sidebar.html' %}
    
        <div class="content-wrapper white-bg">
            
          {% if messages %}
          <div class="col-sm-12">
              {% for message in messages %}
                  <div class="alert 
                      {% if message.tags == 'success' %}alert-success
                      {% elif message.tags == 'error' %}alert-danger
                      {% elif message.tags == 'warning' %}alert-warning
                      {% elif message.tags == 'info' %}alert-info
                      {% else %}alert-secondary{% endif %}
                      w-100 mb-0">
                      <p class="mb-0">{{ message }}</p>
                  </div>
              {% endfor %}
          </div>  
      {% endif %}
            <div class="content-header header-content-bg mb-0">
              <div class="container-fluid">
                <div class="row justify-content-between justify-content-sm-start pb-4">
                  <div class="col col-sm-4">
                    <!-- <h1 class="admin-title m-0 py-2">My Account </h1> -->
                    <!-- <a href="#"><img src="{% static 'dist/img/svg/back_ic.svg' %}" alt="" class="mt-2 pl-3"></a> -->
                  </div>
                  <div class="col">
                    <div class="d-flex justify-content-end mt-2">
                      <!-- <button class="dashboard-btn-outline mb-0" type="button">Deactivate Membership</button> -->
                    </div>  
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Main content -->
            <div class="content px-0">
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-md-4 px-0">
                        <div class="card member-detail-left-card">
                            <div class="card-body box-profile">
                                <a href="javascript:void(0)" data-toggle="modal" data-target="#editUserModal" class="float-right"><i class="fas fa-edit"></i></a>
                                <img src="{% static 'dist/img/svg/profile-avatar-male.svg' %}" alt="" class="card-profile-img">
                                <h3 class="profile-username text-center">{{ user_details.first_name }} {{ user_details.last_name }}</h3>
                                <div class="d-flex justify-content-center mt-2">
                                  {% if user_details.role_id != 1 %}
                                    {% if user_details.activation_status == '1' %}
                                        <p class="text-success">Active</p>
                                    {% else %}
                                        <p class="text-danger">Inactive</p>
                                    {% endif %}
                                  {% endif %}
                                </div>  
                                <div class="profile-info-divider"></div>
                                <ul class="member-detail-list">
                                    <li>
                                        <img src="{% static 'dist/img/svg/gender_ic.svg' %}" alt="">
                                        <span class="list">Gender</span>
                                        <span class="list-output">
                                            {% if user_details.gender == 1 %} Male {% elif user_details.gender == 2 %} Female {% else %} N/A {% endif %}
                                        </span>
                                    </li>
                                    <li>
                                        <img src="{% static 'dist/img/svg/birthday_ic.svg' %}" alt="">
                                        <span class="list">Date of birth</span>
                                        <span class="list-output">{{ user_details.dob }}</span>
                                    </li>
                                    <li>
                                        <img src="{% static 'dist/img/svg/phone_ic.svg' %}" alt="">
                                        <span class="list">Phone</span>
                                        <span class="list-output">{{ user_details.phone }}</span>
                                    </li>
                                    <li>
                                        <img src="{% static 'dist/img/svg/email_ic.svg' %}" alt="">
                                        <span class="list">E-mail</span>
                                        <span class="list-output">{{ user_details.email }}</span>
                                    </li>
                                    <li>
                                        <img src="{% static 'dist/img/svg/state.svg' %}" alt="">
                                        <span class="list">State</span>
                                        <span class="list-output">{{ user_details.state }}</span>
                                    </li>
                                    <li>
                                        <img src="{% static 'dist/img/svg/city.svg' %}" alt="">
                                        <span class="list">City</span>
                                        <span class="list-output">{{ user_details.city }}</span>
                                    </li>
                                    <li>
                                        <img src="{% static 'dist/img/svg/map.svg' %}" alt="">
                                        <span class="list">Pincode</span>
                                        <span class="list-output">{{ user_details.pincode }}</span>
                                    </li>
                                    <li>
                                        <img src="{% static 'dist/img/svg/address.svg' %}" alt="">
                                        <span class="list">Communication Address</span>
                                        <span class="list-output">{{ user_details.address }}</span>
                                    </li>
                                </ul>
                    
                            </div>
                        </div>
                    </div>
                    
                    <!-- Edit Modal -->
                    <div class="modal fade modaldesign" id="editUserModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editModalLabel">Edit User Details</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <form name="user-form" id="user-form-validate" method="POST" action="{% url 'update-user-details' %}">
                                        {% csrf_token %}
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="editFirstName" class="form-lbl">First Name</label>
                                                    <input type="text" class="form-field" id="editFirstName" name="first_name" value="{{ user_details.first_name }}" maxlength="50">
                                                </div>
                                            </div>   
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="editLastName" class="form-lbl">Last Name</label>
                                                    <input type="text" class="form-field" id="editLastName" name="last_name" value="{{ user_details.last_name }}">
                                                </div>
                                            </div>   
                                            <div class="col-md-6">    
                                                <div class="mb-3">
                                                    <label for="editEmail" class="form-lbl">E-mail</label>
                                                    <input type="email" class="form-field" id="editEmail" name="email" value="{{ user_details.email }}">
                                                </div>
                                            </div>   
                                            <div class="col-md-6">    
                                                <div class="mb-3">
                                                    <label for="editPhone" class="form-lbl">Phone</label>
                                                    <input type="text" class="form-field" id="editPhone" name="phone" value="{{ user_details.phone }}">
                                                </div>
                                            </div>   
                                            <div class="col-md-6">    
                                                <div class="mb-3">
                                                    <label for="editGender" class="form-lbl">Gender</label>
                                                    <select class="form-field" id="editGender" name="gender">
                                                        <option value="1" {% if user_details.gender == 1 %} selected {% endif %}>Male</option>
                                                        <option value="2" {% if user_details.gender == 2 %} selected {% endif %}>Female</option>
                                                    </select>
                                                </div>
                                            </div>   
                                            <div class="col-md-6">    
                                                <div class="mb-3">
                                                    <label for="editDob" class="form-lbl">Date of Birth</label>
                                                    <input type="date" class="form-field" id="editDob" name="dob" value="{{ user_details.dob }}">
                                                </div>
                                            </div>   
                                            <div class="col-md-6">    
                                                <div class="mb-3">
                                                    <label for="editState" class="form-lbl">State</label>
                                                    <input type="text" class="form-field" id="editState" name="state" value="{{ user_details.state }}">
                                                </div>
                                            </div>   
                                            <div class="col-md-6">    
                                                <div class="mb-3">
                                                    <label for="editCity" class="form-lbl">City</label>
                                                    <input type="text" class="form-field" id="editCity" name="city" value="{{ user_details.city }}">
                                                </div>
                                            </div>   
                                            <div class="col-md-6">    
                                                <div class="mb-3">
                                                    <label for="editPincode" class="form-lbl">Pincode</label>
                                                    <input type="text" class="form-field" id="editPincode" name="pincode" value="{{ user_details.pincode }}">
                                                </div>
                                            </div>   
                                            <div class="col-md-6">    
                                                <div class="mb-3">
                                                    <label for="editAddress" class="form-lbl">Communication Address</label>
                                                    <input type="text" class="form-field" id="editAddress" name="address" value="{{ user_details.address }}">
                                                </div>
                                            </div>   
                                            <div class="col-md-12">   
                                                <div class="d-flex justify-content-end">
                                                    <button type="submit" class="form-submit-btn">Save Changes</button>
                                                </div>     
                                            </div>    
                                        </div>    
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    

                    <div class="col-md-8 px-0">
                      <div class="card member-detail-right-card">
                        
                        <ul class="nav nav-pills profile-tab">
                            <li class="nav-item text-bold"><a class="nav-link active" href="#membership-tab" data-toggle="tab">Payout Details</a></li>
                            <li class="nav-item text-bold"><a class="nav-link" href="#organisation-tab" data-toggle="tab">Bank Details </a></li>
                            <li class="nav-item text-bold"><a class="nav-link" href="#personal-detail-tab" data-toggle="tab">Documents</a></li>
                        </ul>
                        
                        <!-- /.card-header -->
                        <div class="card-body">
                          <div class="tab-content tab-scrollbar">
                            <div class="active tab-pane" id="membership-tab">
                              
                              {% if request.user.role_id == 1 %}
                              <div class="row mb-3">
                                  <div class="col-md-12">
                                    <div class="d-flex justify-content-end">
                                      <button 
                                          class="dashboard-addbtn" 
                                          data-member="{{ user_details.id }}"
                                          data-toggle="modal" 
                                          data-target="#editCommissionModal" id="addCommissionBtn">
                                          <i class="fas fa-plus"></i> Add Payout
                                      </button>
                                    </div>
                                  </div>
                              </div>
                              {% endif %}
                                <div class="row">
                                    <div class="col-md-12">
                                      <div class="table-responsive">
                                        <table class="table table-design table-trlink">
                                            <thead class="table-thead-bg-light table-header-fix">
                                                <tr>
                                                    <th>Product</th>
                                                    <th>TP Prem. (%)</th>
                                                    <th>OD Prem. (%)</th>
                                                    <th>Net Prem. (%)</th>
                                                    {% if request.user.role_id == 1 %}
                                                    <th>Action</th>
                                                    {% endif %}
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for commission in commissions %}
                                                <tr>
                                                    <td>{{ commission.product_name }}</td>
                                                    <td>{{ commission.tp_percentage }}%</td>
                                                    <td>{{ commission.od_percentage }}%</td>
                                                    <td>{{ commission.net_percentage }}%</td>
                                                    {% if request.user.role_id == 1 %}
                                                    <td>
                                                        <button class="btn btn-xs btn-primary edit-btn" 
                                                                data-id="{{ commission.id }}" 
                                                                data-member="{{ commission.member_id }}"
                                                                data-product="{{ commission.product_id }}"
                                                                data-tp="{{ commission.tp_percentage }}"
                                                                data-od="{{ commission.od_percentage }}"
                                                                data-net="{{ commission.net_percentage }}"
                                                                data-toggle="modal" 
                                                                data-target="#editCommissionModal">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                    </td>
                                                    {% endif %}
                                                </tr>
                                                {% empty %}
                                                <tr>
                                                    <td colspan="5" class="text-center">No commission found</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                      </div>  
                                    </div>
                                </div>
                                
                            </div>
                            
                            <!-- Edit Commission Modal -->
                            <div class="modal fade" id="editCommissionModal" tabindex="-1" aria-labelledby="editCommissionLabel" aria-hidden="true">
                              <div class="modal-dialog">
                                  <div class="modal-content">
                                      <div class="modal-header">
                                          <h5 class="modal-title" id="editCommissionLabel">Manage Commission</h5>
                                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">&times;</button>
                                      </div>
                                      <div class="modal-body">
                                          <form id="editCommissionForm" method="POST" action="{% url 'update-commission' %}">
                                              {% csrf_token %}
                                              <input type="hidden" name="commission_id" id="editCommissionId">
                                              <input type="hidden" name="member_id" id="editMemberId"> <!-- Hidden member ID -->
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label class="form-lbl">Product Name</label>
                                                        <select class="form-field" name="product"  id="editProduct">
                                                            <option value="">Select Product</option>
                                                            {% for product in products %}
                                                                <option value="{{ product.id }}">{{ product.name }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>    
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label class="form-lbl">TP %</label>
                                                        <input type="text" class="form-field percentage" placeholder="TP%" id="editTp" name="tp_percentage">
                                                        <span class="error tp_percentage_err"></span>
                                                    </div>
                                                </div>    
                                                <div class="col-md-6">    
                                                    <div class="mb-3">
                                                        <label class="form-lbl">OD %</label>
                                                        <input type="text" class="form-field percentage" id="editOd" placeholder="OD%" name="od_percentage">
                                                        <span class="error od_percentage_err"></span>
                                                    </div>
                                                </div>    
                                                <div class="col-md-6">    
                                                    <div class="mb-3">
                                                        <label class="form-lbl">Net %</label>
                                                        <input type="text" class="form-field percentage" id="editNet" placeholder="Net%" name="net_percentage">
                                                        <span class="error net_percentage_err"></span>
                                                    </div>
                                                </div>    
                                                <div class="col-md-12">   
                                                    <div class="d-flex justify-content-end">
                                                        <button  button type="submit" class="form-submit-btn">Save</button>
                                                    </div>     
                                                </div>    
                                            </div>  
                                          </form>
                                      </div>
                                  </div>
                              </div>
                            </div>
                            <div class="tab-pane" id="organisation-tab">
                                <!-- Personal Details -->
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="d-flex justify-content-end mb-3">
                                            <button type="button" class="dashboard-addbtn" data-toggle="modal" data-target="#editBankModal">Edit</button>
                                        </div>    
                                    </div>
                                    <div class="col-6 col-sm-6 col-md-4 col-lg-4">
                                        <div class="userdetail-group">
                                            <p class="userdetail-lbl">Account Holder Name</p>
                                            <p class="userdetail-highligt" id="accountHolderName">
                                                {% if bank_details %}
                                                    {{ bank_details.account_holder_name }}
                                                {% else %}
                                                    -
                                                {% endif %}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="col-6 col-sm-6 col-md-4 col-lg-4">
                                        <div class="userdetail-group">
                                            <p class="userdetail-lbl">Re Enter Account Number</p>
                                            <p class="userdetail-highligt" id="reEnterAccountNumber">
                                                {% if bank_details %}
                                                    {{ bank_details.re_enter_account_number }}
                                                {% else %}
                                                    -
                                                {% endif %}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="col-6 col-sm-6 col-md-4 col-lg-4">
                                        <div class="userdetail-group">
                                            <p class="userdetail-lbl">Account Number</p>
                                            <p class="userdetail-highligt" id="accountNumber">
                                                {% if bank_details %}
                                                    {{ bank_details.account_number }}
                                                {% else %}
                                                    -
                                                {% endif %}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="col-6 col-sm-6 col-md-4 col-lg-4">
                                        <div class="userdetail-group">
                                            <p class="userdetail-lbl">IFSC Code</p>
                                            <p class="userdetail-highligt" id="ifscCode">
                                                {% if bank_details %}
                                                    {{ bank_details.ifsc_code }}
                                                {% else %}
                                                    -
                                                {% endif %}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="col-6 col-sm-6 col-md-4 col-lg-4">
                                        <div class="userdetail-group">
                                            <p class="userdetail-lbl">City</p>
                                            <p class="userdetail-highligt" id="city">
                                                {% if bank_details %}
                                                    {{ bank_details.city }}
                                                {% else %}
                                                    -
                                                {% endif %}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="col-6 col-sm-6 col-md-4 col-lg-3">
                                        <div class="userdetail-group">
                                            <p class="userdetail-lbl">State</p>
                                            <p class="userdetail-highligt" id="state">
                                                {% if bank_details %}
                                                    {{ bank_details.state }}
                                                {% else %}
                                                    -
                                                {% endif %}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Edit Button -->
                                
                            </div>
                            
                            
                                                            
                                                        <!-- Edit Modal -->
                            <div class="modal fade" id="editBankModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="editModalLabel">Edit Bank Details</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">&times;</button>
                                        </div>
                                        <div class="modal-body">
                                            <form name="bank-form" id="bank-form" method="POST" action="{% url 'store-bank-data' %}">
                                                {% csrf_token %}
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label for="editAccountHolderName" class="form-lbl">Account Holder Name</label>
                                                            <input type="text" class="form-field" id="editAccountHolderName" name="account_holder_name"
                                                              placeholder="Account Holder Name"  value="{% if bank_details %}{{ bank_details.account_holder_name }}{% endif %}">
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="col-md-6">    
                                                        <div class="mb-3">
                                                            <label for="editAccountNumber" class="form-lbl">Account Number</label>
                                                            <input type="text" class="form-field" id="editAccountNumber" name="account_number"
                                                             placeholder="Account Number" value="{% if bank_details %}{{ bank_details.account_number }}{% endif %}">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label for="editReEnterAccountNumber" class="form-lbl">Re Enter Account Number</label>
                                                            <input type="text" class="form-field" id="editReEnterAccountNumber" name="re_enter_account_number"
                                                             placeholder="Re-Enter Account Number"   value="{% if bank_details %}{{ bank_details.re_enter_account_number }}{% endif %}">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">    
                                                        <div class="mb-3">
                                                            <label for="editIfscCode" class="form-lbl">IFSC Code</label>
                                                            <input type="text" class="form-field" id="editIfscCode" name="ifsc_code"
                                                            placeholder="IFSC Code"    value="{% if bank_details %}{{ bank_details.ifsc_code }}{% endif %}">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">    
                                                        <div class="mb-3">
                                                            <label for="editCity" class="form-lbl">City</label>
                                                            <input type="text" class="form-field" id="editCity" name="city"
                                                             placeholder="City"   value="{% if bank_details %}{{ bank_details.city }}{% endif %}">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">    
                                                        <div class="mb-3">
                                                            <label for="editState" class="form-lbl">State</label>
                                                            <input type="text" class="form-field" id="editState" name="state"
                                                            placeholder="State"    value="{% if bank_details %}{{ bank_details.state }}{% endif %}">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">    
                                                        <div class="d-flex justify-content-end">
                                                            <button id="bank-btn-sub" type="button" class="form-submit-btn">Save Changes</button>
                                                        </div>    
                                                    </div>    
                                                </div>        
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <style>
                                .preview-img {
                                    width: 50px;
                                    height: 50px;
                                    object-fit: cover;
                                    transition: transform 0.2s ease-in-out;
                                    cursor: pointer;
                                }

                                .preview-img:hover {
                                    transform: scale(1.2);
                                }
                                .upload-icon {
                                    display: inline-block;
                                    cursor: pointer;
                                    background: #007bff;
                                    color: #fff;
                                    padding: 6px 12px;
                                    border-radius: 5px;
                                    font-size: 14px;
                                    margin-top: 8px;
                                }
                                .upload-icon i {
                                    margin-right: 5px;
                                }
                                .upload-icon:hover {
                                    background: #0056b3;
                                }


                            </style>

                            <!-- /.tab-pane -->
                            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css">
                            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                            <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.min.js"></script>

                            <div class="tab-pane" id="personal-detail-tab">
                                <div class="row mt-3">
                                    <div class="col-md-12">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <h3 class="card-hding pt-3">Documents</h3>
                                            <button type="button" class="dashboard-addbtn" data-toggle="modal" data-target="#uploadDocumentModal">Upload Documents</button>
                                        </div>    
                                    </div>
                            
                                    {% if docs %}
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>File</th>
                                                    <th>File Type</th>
                                                    <th>Doc ID</th>
                                                    <th>Updated At</th>
                                                    <th>Status</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Aadhaar Card Front -->
                                                <tr>
                                                    <td>
                                                        <a href="{{ docs.aadhaar_card_front.url }}" data-lightbox="aadhaar-set" data-title="Aadhaar Card Front">
                                                            <img class="preview-img" id="aadhaar_card_front_preview" src="{{ docs.aadhaar_card_front.url }}" 
                                                                alt="Aadhaar Front" onerror="this.onerror=null; this.src='/static/dist/img/aadhar-front.jpg';" width="80">
                                                        </a>
                                                    </td>
                                                    <td>Aadhaar Card Front</td>
                                                    <td>{{ docs.aadhaar_number|default:"-" }}</td>
                                                    <td>{{ docs.aadhaar_card_front_updated_at|date:"Y-m-d H:i:s" }}</td>
                                                    <td>{{ docs.aadhaar_status|default:"Pending" }}</td>
                                                    <td>
                                                        <label for="aadhaar_card_front" class="btn btn-sm btn-warning">Edit</label>
                                                        <input type="file" id="aadhaar_card_front" class="d-none" onchange="uploadDocument('aadhaar_card_front')">
                                                    </td>
                                                </tr>
                            
                                                <!-- Aadhaar Card Back -->
                                                <tr>
                                                    <td>
                                                        <a href="{{ docs.aadhaar_card_back.url }}" data-lightbox="aadhaar-set" data-title="Aadhaar Card Back">
                                                            <img class="preview-img" id="aadhaar_card_back_preview" src="{{ docs.aadhaar_card_back.url }}" 
                                                                alt="Aadhaar Back" onerror="this.onerror=null; this.src='/static/dist/img/aadhar-front.jpg';" width="80">
                                                        </a>
                                                    </td>
                                                    <td>Aadhaar Card Back</td>
                                                    <td>{{ docs.aadhaar_number|default:"-" }}</td>
                                                    <td>{{ docs.aadhaar_card_back_updated_at|date:"Y-m-d H:i:s" }}</td>
                                                    <td>{{ docs.aadhaar_status|default:"Pending" }}</td>
                                                    <td>
                                                        <label for="aadhaar_card_back" class="btn btn-sm btn-warning">Edit</label>
                                                        <input type="file" id="aadhaar_card_back" class="d-none" onchange="uploadDocument('aadhaar_card_back')">
                                                    </td>
                                                </tr>
                            
                                                <!-- Pan Card -->
                                                <tr>
                                                    <td>
                                                        <a href="{{ docs.upload_pan.url }}" data-lightbox="pan-set" data-title="Pan Card">
                                                            <img class="preview-img" id="upload_pan_preview" src="{{ docs.upload_pan.url }}" 
                                                                alt="Pan Card" onerror="this.onerror=null; this.src='/static/dist/img/aadhar-front.jpg';" width="80">
                                                        </a>
                                                    </td>
                                                    <td>PAN Card</td>
                                                    <td>{{ docs.pan_number|default:"-" }}</td>
                                                    <td>{{ docs.upload_pan_updated_at|date:"Y-m-d H:i:s" }}</td>
                                                    <td>{{ docs.pan_status|default:"Pending" }}</td>
                                                    <td>
                                                        <label for="upload_pan" class="btn btn-sm btn-warning">Edit</label>
                                                        <input type="file" id="upload_pan" class="d-none" onchange="uploadDocument('upload_pan')">
                                                    </td>
                                                </tr>
                            
                                                <!-- Cancelled Cheque -->
                                                <tr>
                                                    <td>
                                                        <a href="{{ docs.upload_cheque.url }}" data-lightbox="cheque-set" data-title="Cancelled Cheque">
                                                            <img class="preview-img" id="upload_cheque_preview" src="{{ docs.upload_cheque.url }}" 
                                                                alt="Cheque" onerror="this.onerror=null; this.src='/static/dist/img/aadhar-front.jpg';" width="80">
                                                        </a>
                                                    </td>
                                                    <td>Cancelled Cheque</td>
                                                    <td>{{ docs.cheque_number|default:"-" }}</td>
                                                    <td>{{ docs.upload_cheque_updated_at|date:"Y-m-d H:i:s" }}</td>
                                                    <td>{{ docs.cheque_status|default:"Pending" }}</td>
                                                    <td>
                                                        <label for="upload_cheque" class="btn btn-sm btn-warning">Edit</label>
                                                        <input type="file" id="upload_cheque" class="d-none" onchange="uploadDocument('upload_cheque')">
                                                    </td>
                                                </tr>
                            
                                                <!-- 10th Marksheet -->
                                                <tr>
                                                    <td>
                                                        <a href="{{ docs.tenth_marksheet.url }}" data-lightbox="marksheet-set" data-title="10th Marksheet">
                                                            <img class="preview-img" id="tenth_marksheet_preview" src="{{ docs.tenth_marksheet.url }}" 
                                                                alt="10th Marksheet" onerror="this.onerror=null; this.src='/static/dist/img/aadhar-front.jpg';" width="80">
                                                        </a>
                                                    </td>
                                                    <td>10th Marksheet</td>
                                                    <td>{{ docs.tenth_marksheet_doc_id|default:"-" }}</td>
                                                    <td>{{ docs.tenth_marksheet_updated_at|date:"Y-m-d H:i:s" }}</td>
                                                    <td>{{ docs.marksheet_status|default:"Pending" }}</td>
                                                    <td>
                                                        <label for="tenth_marksheet" class="btn btn-sm btn-warning">Edit</label>
                                                        <input type="file" id="tenth_marksheet" class="d-none" onchange="uploadDocument('tenth_marksheet')">
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                            
                                    {% else %}
                                    <div class="col-12">
                                        <p class="text-muted text-center">No documents uploaded yet.</p>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- upload document modal-->
                            <div class="modal fade" id="uploadDocumentModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="editModalLabel">Upload Document</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">&times;</button>
                                        </div>
                                        <div class="modal-body">
                                            
                                            <form name="bank-form" id="bank-form" method="POST" enctype="multipart/form-data" action="{% url 'upload_documents' %}">
                                                {% csrf_token %}
                                            
                                                <input type="hidden" name="user_id" value="{{ request.user.id }}">
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <div class="mb-3">
                                                            <label class="form-lbl">Aadhaar Number</label>
                                                            <input type="text" class="form-field" name="aadhaar_number" placeholder="Aadhaar Number" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md">
                                                        <div class="row">
                                                            <div class="col-6">
                                                                <div class="mb-3">
                                                                    <label class="form-lbl">Aadhaar Card Front</label>
                                                                    <input type="file" class="form-field" name="aadhaar_card_front" required>
                                                                </div>
                                                            </div>
                                                            <div class="col-6">
                                                                <div class="mb-3">
                                                                    <label class="form-lbl">Aadhaar Card Back</label>
                                                                    <input type="file" class="form-field" name="aadhaar_card_back" required>
                                                                </div>
                                                            </div>
                                                        </div>        
                                                    </div>
                                                </div>
                                            
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <div class="mb-3">
                                                            <label class="form-lbl">PAN Number</label>
                                                            <input type="text" class="form-field" name="pan_number" placeholder="PAN Number" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md">
                                                        <div class="mb-3">
                                                            <label class="form-lbl">Upload PAN</label>
                                                            <input type="file" class="form-field" name="upload_pan" required>
                                                        </div>
                                                    </div>
                                                </div>  
                                            
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <div class="mb-3">
                                                            <label class="form-lbl">Cheque Number</label>
                                                            <input type="text" class="form-field" name="cheque_number" placeholder="Cheque Number" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md">
                                                        <div class="mb-3">
                                                            <label class="form-lbl">Upload Cheque</label>
                                                            <input type="file" class="form-field" name="upload_cheque" required>
                                                        </div>
                                                    </div>
                                                </div>
                                            
                                                <!-- 10th Marksheet Upload -->
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <div class="mb-3">
                                                            <label class="form-lbl">Tenth Marksheet</label>
                                                            <input type="file" class="form-field" name="tenth_marksheet" required>
                                                        </div>
                                                    </div>
                                                </div>  
                                            
                                                <button type="submit" class="btn btn-success">Upload</button>
                                            </form>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- /.tab-pane -->
                            <div class="tab-pane" id="claims-tab">
                                <div class="row align-items-center mt-3 mb-3">
                                  <div class="col-md-auto">
                                    <h3 class="card-hding mb-0 pb-0">Claim History</h3>
                                  </div>
                                  <div class="col">
                                    <div class="d-flex justify-content-end">
                                      <a href="#" class="dashboard-btn-outline mx-2">Search Cashless Hospitals</a>
                                      <a href="#" class="dashboard-addbtn">Raise a Claim</a>
                                    </div>
                                  </div>
                                </div>  
                              <!-- Documents -->
                              <div class="table-responsive">
                                <table class="table table-design admin-table-design">
                                  <thead class="align-middle thead-light">
                                      <tr>
                                          <th>Claim ID/Type</th>
                                          <th>Patient Name/Relation</th>
                                          <th>Claim Status/Last Update On</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td colspan="3">
                                        <div class="d-flex justify-content-center py-5">
                                          <div>
                                            <img src="dist/img/svg/drive.svg" alt="" class="mx-auto d-table">
                                            <p class="wrap-small text-gray text-center pt-2">No Data</p>
                                          </div>  
                                        </div>   
                                      </td>
                                    </tr>
                                  </tbody>
                                </table>                               
                               </div>    
                              <!-- /.Documents -->
                            </div>
                          </div>
                            <!-- /.tab-content -->
                        </div>
                      </div>
                    </div>
                  </div>  
                </div>
                
              </div>
            </div>
          </div>
        <!-- /.content-wrapper -->
    <script>
        document.getElementById('user-btn-sub').addEventListener('click', function(event) {
            event.preventDefault();  // Prevent default submit action
            document.getElementById('user-form').submit();  // Submit the user form
        });
        
        document.getElementById('bank-btn-sub').addEventListener('click', function(event) {
            event.preventDefault();  // Prevent default submit action
            document.getElementById('bank-form').submit();  // Submit the bank form
        });
    </script>
    
          
    <script>
      document.addEventListener("DOMContentLoaded", function() {
          // Handle edit button click
          document.querySelectorAll(".edit-btn").forEach(button => {
              button.addEventListener("click", function() {
                  let commissionId = this.getAttribute("data-id");
                  let product = this.getAttribute("data-product");
                  let tp = this.getAttribute("data-tp");
                  let od = this.getAttribute("data-od");
                  let net = this.getAttribute("data-net");
      
                  document.getElementById("editCommissionId").value = commissionId;
                  document.getElementById("editMemberId").value = "";
                  document.getElementById("editProduct").value = product;
                  document.getElementById("editTp").value = tp;
                  document.getElementById("editOd").value = od;
                  document.getElementById("editNet").value = net;
      
                  document.getElementById("editCommissionLabel").innerText = "Edit Payout";
              });
          });
      
          // Handle add commission button click
          document.getElementById("addCommissionBtn").addEventListener("click", function() {
              let memberId = this.getAttribute("data-member");

              document.getElementById("editCommissionForm").reset();
              document.getElementById("editCommissionId").value = "";
              document.getElementById("editMemberId").value = memberId;
              document.getElementById("editCommissionLabel").innerText = "Add Payout";
          });
      });
      </script>
<script>
    function saveChanges() {
                document.getElementById('accountHolderName').innerText = document.getElementById('editAccountHolderName').value;
                document.getElementById('reEnterAccountNumber').innerText = document.getElementById('editReEnterAccountNumber').value;
                document.getElementById('accountNumber').innerText = document.getElementById('editAccountNumber').value;
                document.getElementById('ifscCode').innerText = document.getElementById('editIfscCode').value;
                document.getElementById('city').innerText = document.getElementById('editCity').value;
                document.getElementById('state').innerText = document.getElementById('editState').value;
            
                // Close Modal
                var modal = new bootstrap.Modal(document.getElementById('editModal'));
                modal.hide();
            }
            </script>
                {% include "footer.html" %}
            </div>
            <!-- ./wrapper -->
            
            {% include 'footer-script.html' %}
            
        <script>
           
    // Function to handle document upload with SweetAlert confirmation
    function uploadDocument(documentType) {
        let fileInput = document.getElementById(documentType);
        let file = fileInput.files[0];

        if (!file) return;

        // Show SweetAlert confirmation
        Swal.fire({
            title: 'Are you sure?',
            text: "You are about to upload this image.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, upload it!',
            cancelButtonText: 'Cancel',
        }).then((result) => {
            if (result.isConfirmed) {
                let formData = new FormData();
                formData.append("document_file", file);
                formData.append("document_type", documentType);
                
                // Make the AJAX request to upload the document
                $.ajax({
                    url: "/update-document/",
                    type: "POST",
                    data: formData,
                    processData: false,
                    contentType: false,
                    headers: {
                        "X-CSRFToken": getCookie("csrftoken") 
                    },
                    success: function (response) {
                        if (response.new_image_url) {
                            // Update the preview image
                            let previewImg = document.getElementById(documentType + "_preview");
                            previewImg.src = response.new_image_url;
                            previewImg.onerror = null;

                            // Show success message after upload
                            Swal.fire({
                                title: 'Document Uploaded!',
                                text: 'Your document has been uploaded successfully.',
                                icon: 'success',
                                showConfirmButton: false,
                                timer: 2000 // Show for 1.5 seconds
                            });

                            // Refresh the page after 1 second delay
                            setTimeout(function() {
                                location.reload();
                            }, 2000);  // Delay for 1 second
                        }
                    },
                    error: function (xhr) {
                        console.error(xhr.responseJSON.error);
                    }
                });
            }
        });
    }

    // Function to get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
            let cookies = document.cookie.split(";");
            for (let i = 0; i < cookies.length; i++) {
                let cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === name + "=") {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    </script>
    
    
    </body>

{% endblock %}