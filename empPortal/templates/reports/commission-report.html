{% extends 'master.html' %}

{% block title %}
  Commission Report
{% endblock %}

{% block content %}
{% load static %}
{% load custom_filters %}
<body class="hold-transition sidebar-mini">
<div class="wrapper">
  {% include 'navbar.html' %}
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
   {% include 'sidebar.html' %}

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper white-bg">
    <!-- Content Header (Page header) -->
    <div class="content-header breadcrump-bg">
      <div class="container-fluid ">
        <div class="row py-2">
          <div class="col-sm-6">
            <div class="d-flex align-items-center">
              <a href="javascript:void(0)" class="admin-title m-0 pt-2 text-dark">Commission Report</a>
            </div>
            <ul class="breadcrump">
              <li> <a href="#">Dashboard</a> <i class="fas fa-chevron-right"></i></li>
              <li> <a href="#">Reports</a> <i class="fas fa-chevron-right"></i></li>
              <li>Commission Report</li>
            </ul>
          </div>
          <div class="col-sm-6">
            <div class="d-flex justify-content-end">
              <!-- <a href="/create-user" class="breadcrump-addbtn mr-2"><i class="fas fa-plus"></i>Commission Report</a> -->
              <!-- <a href="/new-role" class="dashboard-btn-outline"><i class="fas fa-plus"></i> New Role</a> -->
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <div class="content">
      <div class="container-fluid mobile-filter">
            <div class="row">
                <button type="button" class="mobile-filter-close">×</button>
                <div class="col-sm-12">
                    <form action=" " method="get">
                        <input type="hidden" name="_token" value="A2fV8nxKXXE5tj11gwhB8wlsa7Q6oj2rS8WfPOGo">
                        <div class="row">
                            <input type="hidden" name="filter_is_on" value="filter_on">
                            

                            <div class="col-sm-2 form-group">
                              <input type="text" placeholder="Insurer Name" name="insurer_name" class="form-field" value="{{ request.GET.insurer_name }}">
                          </div>
                          
                          <div class="col-sm-2 form-group">
                              <input type="text" placeholder="Policy No" name="policy_no" class="form-field" value="{{ request.GET.policy_no }}">
                          </div>

                          <div class="col-sm-2 form-group">
                              <input type="text" placeholder="Service Provider" name="service_provider" class="form-field" value="{{ request.GET.service_provider }}">
                          </div>

                          <div class="col-sm-2 form-group">
                              <input type="text" placeholder="Insurance Company" name="insurance_company" class="form-field" value="{{ request.GET.insurance_company }}">
                          </div>

                          <div class="col-sm-2 form-group">
                              <input type="text" placeholder="Policy Type" name="policy_type" class="form-field" value="{{ request.GET.policy_type }}">
                          </div>

                          <div class="col-sm-2 form-group">
                              <input type="text" placeholder="Vehicle Type" name="vehicle_type" class="form-field" value="{{ request.GET.vehicle_type }}">
                          </div>

                          <div class="col-sm-2 form-group">
                              <input type="text" placeholder="Referral Name" name="referral_name" class="form-field" value="{{ request.GET.referral_name }}">
                          </div>

                          <div class="col-sm-2 form-group">
                              <input type="text" placeholder="Vehicle Registration Number" name="vehicle_reg_no" class="form-field" value="{{ request.GET.vehicle_reg_no }}">
                          </div>

                          <div class="col-sm-2 form-group">
                              <input type="text" placeholder="Policy Start Date" name="policy_start_date" class="form-field" value="{{ request.GET.policy_start_date }}">
                          </div>

                          <div class="col-sm-2 form-group">
                              <input type="text" placeholder="Policy End Date" name="policy_end_date" class="form-field" value="{{ request.GET.policy_end_date }}">
                          </div>

                            <!-- <div class="col-sm-2 form-group">
                                <select name="bill_status" id="status" class="form-field">
                                    <option value="">Select Status</option>
                                    <option value="2">Rejected</option>
                                    <option value="0">Drafted</option>
                                    <option value="4">Approved</option>
                                    <option value="3">Mark As Send</option>
                                    <option value="1"> Convert To Tax Invoice</option>
                                </select>
                            </div> -->
                            <!-- <div class="col-sm-1 form-group">
                                <input class="form-field " placeholder="Invoice  Id " name="invoice_id" id="bill_invoive_date" type="text" value="">
                            </div> -->
                            <!-- <div class="col-sm-1 form-group">
                                <input class="form-field datepicker_common hasDatepicker" placeholder="From Date " name="from_date" id="bill_from_date" type="text" value="" readonly="">
                            </div> -->
                            <!-- <div class="col-sm-1 form-group">
                                <input class="form-field datepicker_common hasDatepicker" placeholder="To Date " name="to_date" id="bill_to_date" type="text" value="" readonly="">
                            </div> -->


                            <div class="col-sm-auto">
                                <div class="row">
                                    <div class="col-auto">
                                        <input type="submit" name="submit_filter" class="filter-search-btn" value="Apply">
                                    </div>
                                    <div class="col-auto">
                                        <a href="{% url 'commission-report' %}" class="filter-search-btn bg-dark">Clear</a>
                                    </div>
                                    <div class="col-auto">
                                        <a href="{% url 'export-commission-report' %}" class="breadcrump-addbtn bg-warning mx-1">Export</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
      </div>
      <div class="container-fluid">
        <div class="row">
          <div class="col-sm-12 col-md-12">
            <div class="card box-shadow-none">
              <div class="card-body px-0 pb-0 pt-0">
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                  <!-- <a class="nav-item nav-link active" id="tab1-tab" data-toggle="tab" href="#tab1" role="tab"
                     aria-controls="tab1" aria-selected="true">Report</a> -->
                  <!-- <a class="nav-item nav-link" id="tab2-tab" data-toggle="tab" href="#tab2" role="tab"
                    aria-controls="tab2" aria-selected="false">Roles</a> -->
                </div>
                <div>
                
                    
                  </div>
                <div class="tab-content" id="nav-tabContent">
                  <div class="tab-pane fade show active" id="tab1" role="tabpanel" aria-labelledby="tab1-tab">
                    
                    <div class="table-responsive table-ht">
                      
                      <table class="table table-design commission-report-table-width">
                        <thead class="table-thead-bg-light table-header-fix">
                            <tr>
                              <th class="nowrap">Policy Month</th>
                              <th class="nowrap">Agent Name</th>
                              <th class="nowrap">SM Name</th>
                              <th class="nowrap">Franchise Name</th>
                              <th class="nowrap">Insurer Name</th>
                              <th class="nowrap">SP Name</th>
                              <th class="nowrap">Issue Date</th>
                              <th class="nowrap">Risk Start Date</th>
                              <th class="nowrap">Payment Status</th>
                              <th class="nowrap">Insurance Company</th>
                              <th class="nowrap">Policy Type</th>
                              <th class="nowrap">Policy No</th>
                              <th class="nowrap">Insured Name</th>
                              <th class="nowrap">Vehicle Type</th>
                              <th class="nowrap">Vehicle Make/Model</th>
                              <th class="nowrap">Gross Weight</th>
                              <th class="nowrap">Reg. No.</th>
                              <th class="nowrap">MFG Year</th>
                              <th class="nowrap">Sum Insured</th>
                              <th class="nowrap">Gross Prem.</th>
                              <th class="nowrap">GST</th>
                              <th class="nowrap">Net Prem.</th>
                              <th class="nowrap">OD Prem.</th>
                              <th class="nowrap">TP Prem.</th>
                              <th class="nowrap">Agent Comm.% OD</th>
                              <th class="nowrap">Agent OD Amount</th>
                              <th class="nowrap">Agent TP Comm</th>
                              <th class="nowrap">Agent TP Amount</th>
                              <th class="nowrap">Agent Comm.% Net</th>
                              <th class="nowrap">Agent Net Amt</th>
                              <th class="nowrap">Agent Bonus</th>
                              <th class="nowrap">Agent Total Comm.</th>
                              {% comment %} <th class="nowrap">Franchise Comm.% OD</th>
                              <th class="nowrap">Franchise OD Amount</th>
                              <th class="nowrap">Franchise TP Comm</th>
                              <th class="nowrap">Franchise Agent TP Amount</th>
                              <th class="nowrap">Franchise Agent Comm.% Net</th>
                              <th class="nowrap">Franchise Agent Net Amt</th>
                              <th class="nowrap">Franchise Bonus</th> {% endcomment %}
                              <th class="nowrap">Franchise Total Comm.</th>
                              <th class="nowrap">Insurer Comm.% OD</th>
                              <th class="nowrap">Insurer OD Amount</th>
                              <th class="nowrap">Insurer TP Comm</th>
                              <th class="nowrap">Insurer TP Amount</th>
                              <th class="nowrap">Insurer Comm.% Net</th>
                              <th class="nowrap">Insurer Net Amt</th>
                              <th class="nowrap">Insurer Bonus</th>
                              <th class="nowrap">Insurer Total Comm.</th>
                              <th class="nowrap">Profit/Loss.</th>
                              <th class="nowrap">TDS %</th>
                              <th class="nowrap">TDS Amount</th>
                              <th class="nowrap">Net Profit</th>
                            </tr>
                        </thead>
                        <tbody>
                          {% for data in policy_data %}
                          <tr>
                            <td>{{ data.policy_infos.policy_month_year|default:"-" }}</td>
                            <td>{{ data.policy_agent_info.referral.name|default:"-" }}</td>
                            <td>{{ data.policy_agent_info.referral.sales|default:"-" }}</td>
                            <td>-</td>
                            <td>{{ data.policy_infos.insurance_company|default:"-" }}</td>
                            <td>-</td>
                            <td>{{ data.policy_infos.policy_issue_date|default:"-" }}</td>
                            <td>{{ data.policy_infos.policy_start_date|default:"-" }}</td>
                            <td>
                              {% if data.policy_infos.net_premium %}
                                Confirmed
                              {% else %}
                                -
                              {% endif %}
                            </td>
                            <td>{{ data.policy_infos.insurance_company|default:"-" }}</td>
                            <td>{{ data.policy_infos.policy_type|default:"-" }}</td>
                            <td>{{ data.policy_infos.policy_number|default:"-" }}</td>
                            <td>{{ data.policy_infos.insurer_name|default:"-" }}</td>
                            <td>{{ data.policy_vehicle_info.vehicle_type|default:"-" }}</td>
                            <td>{{ data.policy_vehicle_info.vehicle_make|default:"-" }}/{{ data.policy_vehicle_info.vehicle_model|default:"-" }}</td>
                            <td>{{ data.policy_vehicle_info.gvw|default:"-" }}</td>
                            <td>{{ data.policy_vehicle_info.registration_number|default:"-" }}</td>
                            <td>{{ data.policy_vehicle_info.manufacture_year|default:"-" }}</td>
                            <td>{{ data.policy_infos.sum_insured|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_infos.gross_premium|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_infos.gst_premium|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_infos.net_premium|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_infos.od_premium|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_infos.tp_premium|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_agent_info.agent_od_comm|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_agent_info.agent_od_amount|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_agent_info.agent_tp_comm|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_agent_info.agent_tp_amount|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_agent_info.agent_net_comm|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_agent_info.agent_net_amount|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_agent_info.agent_incentive_amount|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_agent_info.agent_total_comm_amount|floatformat:2|default:"-" }}</td>
                            {% comment %} <td>{{ data.policy_franchise_info.franchise_od_comm|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_franchise_info.franchise_od_amount|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_franchise_info.franchise_tp_comm|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_franchise_info.franchise_tp_amount|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_franchise_info.franchise_net_comm|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_franchise_info.franchise_net_amount|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_franchise_info.franchise_incentive_amount|floatformat:2|default:"-" }}</td> {% endcomment %}
                            <td>{{ data.policy_franchise_info.franchise_total_comm_amount|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_insurer_info.insurer_od_comm|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_insurer_info.insurer_od_amount|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_insurer_info.insurer_tp_comm|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_insurer_info.insurer_tp_amount|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_insurer_info.insurer_net_comm|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_insurer_info.insurer_net_amount|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_insurer_info.insurer_incentive_amount|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_insurer_info.insurer_total_comm_amount|floatformat:2|default:"-" }}</td>
                            <td>
                              {% with insurer_comm=data.policy_insurer_info.insurer_total_comm_amount|default_if_none:0 %}
                                {% with agent_comm=data.policy_agent_info.agent_total_comm_amount|default_if_none:0 %}
                                  {% with franchise_comm=data.policy_franchise_info.franchise_total_comm_amount|default_if_none:0 %}
                                    {% with insurer_tds=data.policy_insurer_info.insurer_tds_amount|default_if_none:0 %}
                                      {% if insurer_comm %}
                                        {{ insurer_comm|subtract:agent_comm|subtract:franchise_comm|floatformat:2|default:"-" }}
                                      {% else %}
                                        -
                                      {% endif %}
                                    {% endwith %}
                                  {% endwith %}
                                {% endwith %}
                              {% endwith %}
                            </td>
                            <td>{{ data.policy_insurer_info.insurer_tds|floatformat:2|default:"-" }}</td>
                            <td>{{ data.policy_insurer_info.insurer_tds_amount|floatformat:2|default:"-" }}</td>
                            <td>
                              {% with insurer_comm=data.policy_insurer_info.insurer_total_comm_amount|default_if_none:0 %}
                                {% with agent_comm=data.policy_agent_info.agent_total_comm_amount|default_if_none:0 %}
                                  {% with franchise_comm=data.policy_franchise_info.franchise_total_comm_amount|default_if_none:0 %}
                                    {% with insurer_tds=data.policy_insurer_info.insurer_tds_amount|default_if_none:0 %}
                                      {% if insurer_comm %}
                                        {{ insurer_comm|subtract:agent_comm|subtract:franchise_comm|subtract:insurer_tds|floatformat:2|default:"-" }}
                                      {% else %}
                                        -
                                      {% endif %}
                                    {% endwith %}
                                  {% endwith %}
                                {% endwith %}
                              {% endwith %}
                            </td>
                          </tr>
                          {% endfor %}
                      </tbody>
                    </table>
                    </div>
                  </div>
                  
                </div>
              </div>
              <!-- <pre>{{ page_obj|pprint }}</pre>    -->
              <div class="pagination-dynamic">
                {% if page_obj.paginator.num_pages > 1 %}
                    <ul class="pagination">
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value|urlencode }}{% endif %}{% endfor %}">« Prev</a>
                            </li>
                        {% endif %}
            
                        {% for num in page_obj.paginator.page_range %}
                            <li class="page-item {% if num == page_obj.number %}active{% endif %}">
                                <a class="page-link" href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value|urlencode }}{% endif %}{% endfor %}">{{ num }}</a>
                            </li>
                        {% endfor %}
                        
                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value|urlencode }}{% endif %}{% endfor %}">Next »</a>
                            </li>
                        {% endif %}
                    </ul>
                {% endif %}
            </div>
            
            
            

          </div>

        </div>
      </div>
    </div>
  </div>
</div>
<!-- /.content-wrapper -->

<!-- Main Footer -->
{% include 'footer.html' %}

</div>
<!-- ./wrapper -->

{% include 'footer-script.html' %}
</body>

{% endblock %}